# 08 将代码放进盒子—函数

更新时间：2019-08-30 11:14:33

![img](img/5d6894910001ab4406400359.jpg)

![img](img/bg-l-1584237108684.png)![img](img/bg-r-1584237108681.png)

一个不注意小事情的人，永远不会成功大事业。

——戴尔·卡耐基

我们之前介绍过一些函数，如 `print()`、`int()`、`input()` 等。直接使用它们就可以获得一些功能，如向命令行输出内容、转换数字、获取命令行输入，那么它们到底是什么呢？



### 函数的初步理解

大家应该都非常熟悉数学上的函数，简单来说数学上的函数就是一个映射关系，给定一个 x，经映射后将得到 y 值，至于这其中的映射关系我们可以直接把它抽象为 y=f(x)。

程序中的函数与数学上的函数有一丝类似，我们也可以把它抽象地看作一个映射关系，给定输入参数后，经函数映射，返回输出结果。如之前我们使用过的 `int()` 和 `len()`：

```python
数字 = int(字符串)
长度 = len(列表)
```

给定输入值，经函数处理，返回输出值，这是函数最单纯的模式。



### 函数如何定义

Python 中函数的定义方式如下：

```python
def 函数名(参数1, 参数2, ...):
    代码块
```

函数的输入值叫做**函数参数**，如上面的「参数1」、「参数2」。函数参数的个数可以是任意个，如 0 个、1 个或多个。需要注意参数是有顺序的，使用时要按对应位置传递参数。

函数内部的代码块就是**函数的实现**。所有的函数功能都实现于此。

函数的输出结果叫函数的**返回值**。函数可以没有返回值，也可以有一个或多个返回值。返回值通过 `return` 语句传递到函数外部，如：

```python
def add(x, y):
    return x + y
```

#### 函数定义示例

我们来编写一个函数试试，这个函数的需要的参数是年龄，返回值是年龄对应的人生阶段。

| 年龄      | 人生阶段 |
| :-------- | :------- |
| 0-6 岁    | 童年     |
| 7-17 岁   | 少年     |
| 18-40 岁  | 青年     |
| 41-65 岁  | 中年     |
| 65 岁之后 | 老年     |

这个功能好像有点眼熟，没错，上一章节中我们完成过这个功能，现在把这个功能改写成函数。

可以这样来定义这个函数：

```python
def stage_of_life(age):
    if age <= 6:
        return '童年'
    elif 7 <= age <=17:
        return '少年'
    elif 18 <= age <= 40:
        return '青年'
    elif 41 <= age <= 65:
        return '中年'
    else:
        return '老年'
```

我们给函数起名为 `stage_of_life`，需要一个参数 `age`，最终通过 `return` 语句返回对应的人生阶段，这个人生阶段就是函数的返回值。

这里虽然有多个 `return` 语句，但是实际上每次函数使用时，只会有一个 `return` 语句被执行。

#### 副作用

上面这个示例中，给定一个参数 `age`，便返回对应的人生阶段。函数内部只是做了一个映射，并没有对程序和系统的状态作出影响，这样的函数是**纯函数**。

纯函数是函数的一个特例，更普遍的情况是，函数包含一些会引起程序或系统状态变化的操作，如修改全局变量、命令行输入输出、读写文件等，这样的变化叫做函数的**副作用**。

副作用并不是不好的作用，它只是函数在输入值和输出值间映射之外，所附带的作用。副作用在有些时候是不可避免的。

因为有了副作用，函数就**不必**完全遵从 `输入 -> 映射 -> 输出` 这种模式，函数可以在没有参数或返回值的情况下，拥有其功能。如果你看到一个函数没有参数或返回值，要自然的想到，那是副作用在发挥作用。

没有参数没有返回值：

```python
def say_hello():
    print('hello')
```

有参数没有返回值：

```python
def say_words(words):
    print(words)
```

没有参数有返回值：

```python
def pi():
    return 3.14159
```



### 函数的调用

函数定义完成后，就可以在后续的代码中使用它了，对函数的使用叫做函数**调用**。

以前我们调用过 `int()`、`len()`，它们是内置在 Python 语言中的函数，也就是**内置函数**。现在我们自己定义了 `stage_of_life`，调用的方式是一样的：

```python
def stage_of_life(age):
    if age <= 6:
        return '童年'
    elif 7 <= age <=17:
        return '少年'
    elif 18 <= age <= 40:
        return '青年'
    elif 41 <= age <= 65: 
		return '中年'
    else:
        return '老年'

stage = stage_of_life(18)
print(stage)
```

用参数的形式将数据传递给函数，用赋值语句来接收返回值。

需要说明的是

- 函数有多个参数时，参数是有顺序的，要按对应位置将参数传递进去。

  > \>>> def minus(x, y):
  > … return x - y
  > …
  > \>>> minus(1, 3)
  > -2
  > \>>> minus(3, 1)
  > 2

- 函数需要先经过定义，之后才能被调用，否则解释器将找不到这个函数名，也就无法调用它。

  未定义函数便直接调用，解释器将报出「名字未定义」的错误：

  > \>>> stage = abc(18)
  > Traceback (most recent call last):
  > File “”, line 1, in
  > NameError: name ‘abc’ is not defined



### 函数有什么用

从形式上来看，函数将一段代码包裹起来，调用函数就像当于执行那段代码。代码所需要的数据我们可以通过函数参数的形式传递进去，代码的执行结果通过返回值出传递出来。那么函数到底有什么用呢？

#### 抽象

函数的价值主要体现在调用时，而不是定义时。调用时函数就像个盒子，使用者不需要了解其中有什么代码，是什么样的逻辑，只要知道怎么使用它的功能就足够了。以 `len()` 函数为例，我们不知道这个函数的原理，但是能用它达到我们获取列表长度的目的，这就是它的重要价值。

简单来说**函数的主要作用是抽象**，屏蔽繁杂的内部细节，让使用者在更高的层次上简单明了地使用其功能。我们之前说过「计算机的世界里最重要的原理之一就是抽象」，函数就是其一个体现。

#### 代码复用

因为具有抽象的好处，函数也延伸出另一个作用——**复用**，或者叫代码复用。也就是便于重复使用，节省代码。举个例子，假如我们想用程序计算并输出 -33，456，-0.03 的绝对值，不用函数时我们这样写：

```python
number = -33
if number > 0:
    print(number)
else:
    print(-number)
    
number = 456
if number > 0:
    print(number)
else:
    print(-number)
    
number = -0.03
if number > 0:
    print(number)
else:
    print(-number)
```

显然有大量重复的代码，这些重复代码是可以避免的。用函数修改后如下：

```python
def print_absolute(number):
   if number > 0:
       print(number)
   else:
       print(-number) 
       
print_absolute(-33)
print_absolute(456)
print_absolute(-0.03)
```

代码量减少很多，也能应对未来的相同需求，这就是复用的好处。



### 什么时候用函数

看了上面函数的好处之后，想必你已经知道在什么时候用函数了吧？

- 需要通过函数的形式把这些复杂性隔离出来，之后在使用时只需调用这个函数即可，清晰且优雅。
- 需要复用时。一段相似甚至完全一致的代码在多处被使用，可以考虑将这段代码定义为函数，然后在各处去调用它。



### 总结

函数的主要作用是抽象和代码复用。

Python 中函数的定义方法：

```python
def 函数名(参数1, 参数2, ...):
    代码块
```

返回值通过 `return` 语句传递到函数外部。

> ### 多语言比较
>
> Java 中所有的函数都需要定义在类中，类中的函数也叫做方法。
>
> Java 中定义函数：
>
> ```java
> int add(int x, int y) {
>  return x + y
> }
> ```
>
> C/C++ 中定义函数：
>
> ```c
> int add(int x, int y) {
>  return x + y
> }
> 预览
> ```
>
> Go 中定义函数：
>
> ```go
> func max(x, y int) int {
>    return x + y
> }
> ```